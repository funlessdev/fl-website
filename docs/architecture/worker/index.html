<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" as="font" href="https://funless.dev/fonts/vendor/jost/jost-v4-latin-regular.woff2" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="https://funless.dev/fonts/vendor/jost/jost-v4-latin-700.woff2"  type="font/woff2" crossorigin>


<link rel="stylesheet" href="https://funless.dev/main.css">



  
  
    
  

  
  
    
    
  
  
  
    
  
  
  
  
    
  
  
  


  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  <meta name="bingbot" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">


	


	

<title>Worker | FunLess</title>
<meta name="description" content="The Worker component.">
<link rel="canonical" href="https://funless.dev/docs/architecture/worker/">


  <meta name="twitter:card" content="summary_large_image">
  
    <meta name="twitter:image" content="https://funless.dev/doks.png">
  
  <meta name="twitter:title" content="Worker">
  <meta name="twitter:description" content="The Worker component.">
  <meta name="twitter:site" content="@funlessdev">
  <meta name="twitter:creator" content="@funlessdev">
  
  <meta property="og:title" content="Worker">
  <meta property="og:description" content="The Worker component.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://funless.dev/docs/architecture/worker/">

  
    <meta property="og:image" content="https://funless.dev/doks.png">
  

  <meta property="og:updated_time" content="2021-05-01T08:20:00+00:00">
  <meta property="og:site_name" content="Worker">

  

  

  
  <meta property="og:locale" content="en_US">





  





<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "BreadcrumbList",
    
      
      
        
        
        
        
        
        
        
        
          {
            "@type": "ListItem",
            "position":  1 ,
            "name": "Home",
            "item": "https://funless.dev/"
          },
          
          
          {
            "@type": "ListItem",
            "position":  2 ,
            "name": "Docs",
            "item": "https://funless.dev/docs/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  3 ,
            "name": "Architecture",
            "item": "https://funless.dev/docs/architecture/"
          },
        
      
        
        
        
        
        
        
        
        
          
          
          {
            "@type": "ListItem",
            "position":  4 ,
            "name": "Worker",
            "item": "https://funless.dev/docs/architecture/worker/"
          },
        
      
    
  }
</script>






  <meta name="theme-color" content="#ffffff">
  <link rel="apple-touch-icon" sizes="180x180" href="https://funless.dev/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://funless.dev/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://funless.dev/favicon-16x16.png">
  
    <link rel="manifest" href="https://funless.dev/site.webmanifest" crossorigin>
  


  
    
      <!-- KaTeX -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    
  

</head>

  

<body class="docs single">
  <script>
// enforce local storage setting but also fallback to user-agent preferences
if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
  document.body.classList.add('dark');
}
  </script>
  
<script type="text/javascript" src="https://funless.dev/js/main.js" defer></script>

  <script type="text/javascript" src="https://funless.dev/plugins/elasticlunr.min.js" defer></script>
  <script type="text/javascript" src="https://funless.dev/search_index.en.js" defer></script>
  <script type="text/javascript" src="https://funless.dev/js/search.js" defer></script>

  
  
  
  
  
<div class="header-bar fixed-top"></div>
<header class="navbar fixed-top navbar-expand-md navbar-light">
	<div class="container">
		<input class="menu-btn order-0" type="checkbox" id="menu-btn">
		<label class="menu-icon d-md-none" for="menu-btn"><span class="navicon"></span></label>
		<a class="navbar-brand order-1 order-md-0 me-auto" href="https://funless.dev">FunLess</a>
		<button id="mode" class="btn btn-link order-2 order-md-4" type="button" aria-label="Toggle mode">
			<span class="toggle-dark"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg></span>
			<span class="toggle-light"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></span>
		</button>
		<ul class="navbar-nav fork-me order-3 order-md-5">
			
				
					<li class="nav-item">
						<a class="nav-link" href="https://github.com/funlessdev"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg><span class="ms-2 visually-hidden">GitHub</span></a>
					</li>
				
			
		</ul>
		<div class="collapse navbar-collapse order-4 order-md-1">
			<ul class="navbar-nav main-nav me-auto order-5 order-md-2">
				
					
				
				
				
					
						<li class="nav-item docs active">
							<a class="nav-link" href="https://funless.dev/docs/getting-started/introduction/">Docs</a>
						</li>
					
						<li class="nav-item">
							<a class="nav-link" href="https://funless.dev/blog/">Blog</a>
						</li>
					
				
			</ul>
			<div class="break order-6 d-md-none"></div>
			
				<form class="navbar-form flex-grow-1 order-7 order-md-3">
					<input id="userinput" class="form-control is-search" type="search" placeholder="Search docs..."
						aria-label="Search docs..." autocomplete="off">
					<div id="suggestions" class="shadow bg-white rounded"></div>
				</form>
			
		</div>
	</div>
</header>



  
<div class="wrap container" role="document">
  <div class="content">
    <div class="row flex-xl-nowrap">
	  
<div class="col-lg-5 col-xl-4 docs-sidebar">
	<nav class="docs-links" aria-label="Main navigation">
			
			
			
			
					
					
					
							<h3>Getting Started</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/getting-started/introduction/">Introduction</a></li>
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/getting-started/quick-start/">Quick Start</a></li>
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/getting-started/kubernetes/">Running on Kubernetes</a></li>
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/getting-started/nomad/">Running on Nomad</a></li>
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/getting-started/bare-metal/">Running FunLess without orchestrators</a></li>
							
					</ul>
					
					
					
					
							<h3>Architecture</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/architecture/overview/">Overview</a></li>
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/architecture/core/">Core</a></li>
							                           
									<li><a class="docs-link active" href="https://funless.dev/docs/architecture/worker/">Worker</a></li>
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/architecture/entities/">Entities</a></li>
							
					</ul>
					
					
					
					
							<h3>Contributing</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/contributing/how-to-contribute/">How to Contribute</a></li>
							
					</ul>
					
					
					
					
							<h3>Roadmap</h3>
							<ul class="list-unstyled">
							                           
									<li><a class="docs-link" href="https://funless.dev/docs/roadmap/roadmap/">Roadmap</a></li>
							
					</ul>
					
					
			
	</nav>
</div>

	  
  

      <main class="docs-content col-lg-11 col-xl-9">
        <h1>Worker</h1>
        
        <p>The Worker is the main function executor of the FunLess platform. In a standard deployment, there normally are as many Workers as the total number of nodes (potentially minus one, if the Core node is not used as an executor).</p>
<p>Each Worker embeds a WebAssembly runtime (currently <a href="https://github.com/bytecodealliance/wasmtime">Wasmtime</a>), to instantiate and run functions. Each function is a WebAssembly module, with the addition of the several imports/exports (see below).</p>
<h3 id="funless-compatible-webassembly-modules">FunLess-compatible WebAssembly modules</h3>
<p>As of right now, standard WebAssembly modules are not runnable by FunLess (and vice-versa, FunLess-compatible modules are not runnable by standalone runtimes), because of several requirements in terms of imported and exported functions. We list here the required imports/exports the module must satisfy.</p>
<p>To produce FunLess-compatible modules, we currently use language-specific wrappers, which can be found in a dedicated <a href="https://github.com/funlessdev/fl-wasm">repository</a>. This approach is subject to change and we plan on greatly improving the usability of the platform, by integrating the building process with our CLI and increasing compatibility with standard WebAssembly modules.</p>
<h4 id="imported-functions">Imported functions</h4>
<ul>
<li>
<p><code>__get_input_data</code> asks the runtime to write the input data to memory. It takes a single integer as input, representing the pointer where the data will be written.</p>
</li>
<li>
<p><code>__insert_response</code> inserts the function's response in memory. It takes two integers as input, representing the pointer to the response, and its length.</p>
</li>
<li>
<p><code>__insert_error</code> same as <code>__insert_response</code>, used in case the function encountered an error.</p>
</li>
<li>
<p><code>__http_request</code> performs an HTTP request, with a JSON body and a JSON response. Takes several parameters, in the following order:</p>
<ul>
<li>pointer to the response and pointer to its length, which will be populated by the runtime after the request is performed</li>
<li>pointer to the status, also populated by the runtime</li>
<li>method (an integer from 0 to 3, representing <code>GET</code>, <code>POST</code>, <code>PUT</code> and <code>DELETE</code> in this order)</li>
<li>pointer and length of the URL</li>
<li>pointer and length of the headers, codified as a string</li>
<li>pointer and length of the body</li>
</ul>
<p>This function will probably be scrapped, as the WASI standard has recenly included HTTP requests and socket operations, so there will be no need for a custom import.</p>
</li>
<li>
<p><code>__console_log</code> is a debugging function, to be removed in the future (or at least disabled in production environments). Prints the given string (identified by two integers, a pointer to the message and its length) as a debugging log on the Worker. </p>
</li>
</ul>
<h4 id="exported-functions">Exported functions</h4>
<ul>
<li><code>__invoke</code> is used by FunLess to actually run the module. This function basically extracts the input from memory using <code>__get_input_data</code>, runs the <code>main</code> function (or its equivalent) in the given language, and inserts the results in memory using <code>__insert_response</code> or <code>__insert_error</code>. <code>__invoke</code> takes a single integer as argument, representing the length of the function's input (generally stringified JSON).</li>
</ul>
<p>When loading the input data, the general workflow is:</p>
<ul>
<li>initialize an array of length <code>N</code>, where <code>N</code> is the parameter passed to <code>__invoke</code></li>
<li>call <code>__get_input_data</code> with a pointer to the array</li>
<li>parse the array as a string</li>
<li>pass the string to the <code>main</code> function (the actual user-defined function)</li>
</ul>
<p><code>__invoke</code> also returns either 0 or 1, for success and failure respectively, after having called <code>__insert_response</code> (or <code>__insert_error</code>).</p>

        
          
<p class="edit-page"><a href="https:&#x2F;&#x2F;github.com&#x2F;funlessdev&#x2F;fl-website/blob/main/content&#x2F;docs&#x2F;architecture&#x2F;worker.md"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>Edit this page on GitHub</a></p>

        
        
<div class="docs-navigation d-flex justify-content-between">
  
  
  
  
  
    
    
    
    
      
        
        
          
        
      
        
        
          
        
      
        
        
          
        
      
        
        
          
            
              
              <a href="https:&#x2F;&#x2F;funless.dev&#x2F;docs&#x2F;getting-started&#x2F;bare-metal&#x2F;">
                <div class="card my-1">
                  <div class="card-body py-2">
                    &larr; Running FunLess without orchestrators
                  </div>
                </div>
              </a>
            
            
            
          
        
      
    
  

  
  
  
  
  
    
    
    
      
      
        
      
    
      
      
        
      
    
      
      
        
          
          
          <a class="ms-auto" href="https:&#x2F;&#x2F;funless.dev&#x2F;docs&#x2F;contributing&#x2F;how-to-contribute&#x2F;">
            <div class="card my-1">
              <div class="card-body py-2">
                How to Contribute &rarr;
              </div>
            </div>
          </a>
          
          
          
        
      
    
      
      
        
      
    
  
</div>

      </main>
    </div>
  </div>
</div>


  
    
<footer class="footer text-muted">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 order-last order-lg-first">
				<ul class="list-inline">
					
						<li class="list-inline-item">Powered by <a href="https://www.getzola.org/">Zola</a>, and <a href="https://github.com/aaranxu/adidoks">AdiDoks</a></li>
					
				</ul>
			</div>
			<div class="col-lg-8 order-first order-lg-last text-lg-end">
				<ul class="list-inline">
					
						
							<li class="list-inline-item"><a href="https://funless.dev/privacy-policy/">Privacy</a></li>
						
					
				</ul>
			</div>
		</div>
	</div>
</footer>

  

</body>
</html>
